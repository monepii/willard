{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√∫squeda Avanzada - WILLARD</title>
    <link rel="stylesheet" href="{% static 'CSS/styles.css' %}">
    <link rel="stylesheet" href="{% static 'ferretetia/CSS/styles.css' %}">
    <link rel="stylesheet" href="{% static 'ferretetia/CSS/filters.css' %}">
    <link rel="stylesheet" href="{% static 'ferretetia/CSS/search.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/styles2.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/styles_footer.css' %}">
</head>
<body>
    {% include "ferretetia/auth.html" %}
    
    <header>
        <nav class="navbar">
            <div class="navbar-left">
                <div class="logo-container">
                    <a href="{% url 'ferretetia:index' %}">
                        <div class="logo-bg">WILLARD</div>
                    </a>
                </div>
            </div>
            <div class="navbar-center">
                <div class="search-container">
                    <input type="text" placeholder="Buscar Productos..." class="search-input">
                    <button class="search-btn">BUSCAR</button>
                </div>
            </div>
            <div class="navbar-right">
                <a href="{% url 'wishlist:wishlist' %}" class="nav-item">
                    <span class="icon">‚ô° WISHLIST</span>
                </a>
                <a href="{% url 'compare:compare' %}" class="nav-item">
                    <span class="icon">‚öñ COMPARAR</span>
                </a>
                <a href="{% url 'account:account' %}" class="nav-item">
                    <span class="icon">üë§ MI CUENTA</span>
                </a>
                <a href="{% url 'checkout:checkout' %}" class="nav-item">
                    <span class="icon">üìã CHECKOUT</span>
                </a>
                <a href="{% url 'cart:cart' %}" class="nav-item cart">
                    <span class="icon">üõí CARRITO {% if cart_count > 0 %}({{ cart_count }}){% endif %}</span>
                </a>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="container">
            
            <!-- Header de b√∫squeda avanzada -->
            <div class="shop-header">
                <h1>üîç B√∫squeda Avanzada</h1>
                <div class="shop-stats">
                    <span class="products-count">{{ stats.productos_filtrados }} de {{ stats.total_productos }} productos</span>
                    <span class="products-count">{{ stats.categorias_filtradas }} de {{ stats.total_categorias }} categor√≠as</span>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>üì¶ Productos Disponibles</h3>
                    <p class="stat-number">{{ stats.productos_disponibles }}</p>
                </div>
                <div class="stat-card">
                    <h3>üè∑Ô∏è Con Descuento</h3>
                    <p class="stat-number">{{ stats.productos_con_descuento }}</p>
                </div>
                <div class="stat-card">
                    <h3>üìä Productos Filtrados</h3>
                    <p class="stat-number">{{ stats.productos_filtrados }}</p>
                </div>
                <div class="stat-card">
                    <h3>üìÇ Categor√≠as Filtradas</h3>
                    <p class="stat-number">{{ stats.categorias_filtradas }}</p>
                </div>
            </div>

            <div class="advanced-layout">
                <!-- Filtros de productos -->
                <aside class="filters-sidebar">
                    <div class="filters-header">
                        <h3>üîç Filtros de Productos</h3>
                        {% if filtros_aplicados %}
                            <a href="{% url 'ferretetia:advanced_search' %}" class="clear-filters-btn">Limpiar</a>
                        {% endif %}
                    </div>

                    <form method="get" class="filters-form">
                        <!-- B√∫squeda general -->
                        <div class="filter-group">
                            <label for="{{ producto_filter.form.search.id_for_label }}">Buscar productos</label>
                            {{ producto_filter.form.search }}
                        </div>

                        <!-- Filtro por categor√≠a -->
                        <div class="filter-group">
                            <label for="{{ producto_filter.form.categoria.id_for_label }}">Categor√≠a</label>
                            {{ producto_filter.form.categoria }}
                        </div>

                        <!-- Rango de precios -->
                        <div class="filter-group">
                            <label>Rango de precios</label>
                            <div class="price-range">
                                <div class="price-input">
                                    <label for="{{ producto_filter.form.precio_min.id_for_label }}">M√≠nimo</label>
                                    {{ producto_filter.form.precio_min }}
                                </div>
                                <div class="price-input">
                                    <label for="{{ producto_filter.form.precio_max.id_for_label }}">M√°ximo</label>
                                    {{ producto_filter.form.precio_max }}
                                </div>
                            </div>
                        </div>

                        <!-- Filtros booleanos -->
                        <div class="filter-group">
                            <div class="checkbox-filters">
                                <div class="checkbox-item">
                                    {{ producto_filter.form.disponible }}
                                    <label for="{{ producto_filter.form.disponible.id_for_label }}">
                                        Solo disponibles
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    {{ producto_filter.form.con_descuento }}
                                    <label for="{{ producto_filter.form.con_descuento.id_for_label }}">
                                        Solo con descuento
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Stock m√≠nimo -->
                        <div class="filter-group">
                            <label for="{{ producto_filter.form.stock_min.id_for_label }}">Stock m√≠nimo</label>
                            {{ producto_filter.form.stock_min }}
                        </div>

                        <!-- Ordenamiento -->
                        <div class="filter-group">
                            <label for="{{ producto_filter.form.ordenar.id_for_label }}">Ordenar por</label>
                            {{ producto_filter.form.ordenar }}
                        </div>

                        <!-- Botones de acci√≥n -->
                        <div class="filter-actions">
                            <button type="submit" class="apply-filters-btn">Aplicar Filtros</button>
                            <button type="reset" class="reset-filters-btn">Restablecer</button>
                        </div>
                    </form>
                </aside>

                <!-- Resultados -->
                <main class="results-main">
                    <div class="results-header">
                        <h2>Resultados de Productos</h2>
                        <span class="results-count">{{ stats.productos_filtrados }} productos encontrados</span>
                    </div>

                    <div class="products-grid">
                        {% for producto in productos %}
                        <div class="product-card">
                            <div class="product-image">
                                {% if producto.imagen %}
                                <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}">
                                {% else %}
                                <div class="product-image-placeholder">
                                    <span>{{ producto.nombre|slice:":1"|upper }}</span>
                                </div>
                                {% endif %}
                                {% if producto.descuento %}
                                <span class="sale-badge">SALE</span>
                                {% endif %}
                            </div>
                            <div class="product-info">
                                <h3 class="product-title">{{ producto.nombre }}</h3>
                                <p class="product-sku">SKU: {{ producto.sku }}</p>
                                {% if producto.categoria %}
                                <p class="product-category">{{ producto.categoria.nombre }}</p>
                                {% endif %}
                                <div class="product-pricing">
                                    {% if producto.descuento and producto.precioDescuento %}
                                    <span class="price-original">${{ producto.precio }}</span>
                                    <span class="price-sale">${{ producto.precioDescuento }}</span>
                                    {% else %}
                                    <span class="price-current">${{ producto.precio }}</span>
                                    {% endif %}
                                </div>
                                <div class="product-stock">
                                    <span class="stock-info">Stock: {{ producto.stock }}</span>
                                    <span class="availability {% if producto.disponible %}available{% else %}unavailable{% endif %}">
                                        {% if producto.disponible %}Disponible{% else %}No disponible{% endif %}
                                    </span>
                                </div>
                                <div class="product-actions">
                                    <button class="wishlist-btn" title="Agregar a favoritos" data-product-id="{{ producto.id }}">
                                        <span class="wishlist-icon">‚ô°</span>
                                    </button>
                                    <button class="compare-btn" title="Comparar" data-product-id="{{ producto.id }}">‚öñ</button>
                                    <button class="view-btn" title="Vista r√°pida" data-product-id="{{ producto.id }}">üëÅ</button>
                                </div>
                                <button class="add-to-cart-btn" data-product-id="{{ producto.id }}">Agregar al Carrito</button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="no-results">
                            <h3>No se encontraron productos</h3>
                            <p>Intenta ajustar los filtros de b√∫squeda</p>
                            <a href="{% url 'ferretetia:advanced_search' %}" class="btn-primary">Limpiar filtros</a>
                        </div>
                        {% endfor %}
                    </div>
                </main>
            </div>
        </div>
    </main>

    <footer class="footer">
        {% include "ferretetia/footer.html" %}
    </footer>

    <script src="{% static 'ferretetia/script.js' %}"></script>
    <script src="{% static 'ferretetia/search.js' %}"></script>
    <script src="{% static 'ferretetia/products.js' %}"></script>
</body>
</html>
